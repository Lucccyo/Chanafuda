<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style/style.css">
  <style>
    body {
      /* background-color: rgb(230, 222, 212); */
      background-image: url('/img/hanafudraw_complet.png');
      margin: 0;
    }

    .game {
      display: flex;
      flex-direction: column;
      height: 100vh;
      width: 100vw;
    }

    .bloc {
      height: 33.333%;
      width: 100%;
      display: flex;
      align-items: center;
    }

    .carte {
      height: 117px;
      width: 70px;
      margin: 5px;
      background-color: rgb(136, 113, 82);
    }
    

    .main {
      display: flex;
      flex-direction: row;
      width: 100%;
    }

    .demi {
      display: flex;
      height: 100%;
      width: 50%;
      align-items: center;
    }

    .right .carte {
      background-color: rgb(233, 210, 182);
    }

    #mid .board {
      display: flex;
      flex-direction: column;
      margin-left: 30vw;
    }

    #mid .board .rangee {
      display: flex;
    }

    .tas {
      background-color: rgb(71, 60, 44);
    }

    button {
      width: 100%;
      height: 100%;
      background-color: rgba(136, 113, 82, 0);
    }
  </style>
  <script src="/socket.io/socket.io.js"></script>
  <title>Hanafuda</title>
</head>

<body>
  <div class="game">
    <div class="bloc" id="top">
      <div class="left demi" id="enemy">

      </div>
      <div class="right demi">
        <div class="carte"></div>
        <div class="carte"></div>
        <div class="carte"></div>
        <div class="carte"></div>
        <div class="carte"></div>
        <div class="carte"></div>
        <div class="carte"></div>
        <div class="carte"></div>
      </div>
    </div>
    <div class="bloc" id="mid">
      <div class="carte tas" id="tas"></div>
      <div class="board">
        <div class="top rangee" id="board_top">

        </div>
        <div class="bot rangee" id="board_bot">

        </div>
      </div>
    </div>
    <div class="bloc" id="bot">
      <div class="left demi" id="perso">

      </div>
      <div class="right demi">
        <div class="carte"></div>
        <div class="carte"></div>
        <div class="carte"></div>
        <div class="carte"></div>
        <div class="carte"></div>
        <div class="carte"></div>
        <div class="carte"></div>
        <div class="carte"></div>
      </div>
    </div>
  </div>


  <script>
    var socket = io();
    var enemy_stack = document.getElementById('enemy');
    var perso_stack = document.getElementById('perso');
    var board_top = document.getElementById('board_top');
    var board_bot = document.getElementById('board_bot');
    var tas = document.getElementById('tas');

    socket.on('draw', function (card_name) {
      tas.textContent = card_name;
    });

    socket.on('perso', function (tab) {
      perso_stack.innerHTML = '';
      for (let i = 0; i < tab.length; i++) {
        add_card(tab[i], perso_stack);
      }
    });

    socket.on('enemy', function (nb_card) {
      enemy_stack.innerHTML = '';
      for (let i = 0; i < nb_card; i++) {
        add_enemy_card();
      }
    });

    socket.on('board', function (tab) {
      board_bot.innerHTML = '';
      board_top.innerHTML = '';
      for (let i = 0; i < tab.length; i++) {
        if (i % 2 == 0) {
          add_board_card(tab[i], board_top, i);
        } else {
          add_board_card(tab[i], board_bot, i);
        }
      }
    });

    socket.on('pile', function (nb_card) {
      console.log("Dans la pile, il y a " + nb_card + " cartes.");
    });

    socket.on('playable', function (tab) {
      for (let i = 0; i < tab.length; i++) {
        let div = document.getElementById(tab[i])
        var p = document.createElement("button");
        p.onclick = function () {

          if(((div.parentNode).id) == 'perso') {
            send_card_turn(tab[i]);
          } else {
            send_card_choice(tab[i]);
          }
        }
        div.appendChild(p);
      }
    });

    function add_enemy_card() {
      var div = document.createElement("div");
      div.classList.add('carte');
      enemy_stack.append(div);
    }

    function add_card(nom, stack) {
      var div = document.createElement("div");
      div.classList.add('carte');
      div.setAttribute('id', nom);
      div.innerText = nom;
      stack.append(div);
    }

    function add_board_card(nom, stack, index) {
      var div = document.createElement("div");
      div.classList.add('carte');
      div.setAttribute('id', index);
      div.setAttribute('id', nom);
      div.innerText = nom;
      stack.append(div);
    }


    function send_card_turn(card_n) {
      // envoie de la carte cliquée
      socket.emit('turn', card_n);
    }

    function send_card_choice(card_choose) {
      // envoie de la carte cliquée
      if(tas.textContent == null) {
        tab = ['h', card_choose];
        socket.emit('choice', tab);
      } else {
        tab = ['s', card_choose];
        socket.emit('choice', tab);
      }
      
    }
    

  </script>
</body>

</html>